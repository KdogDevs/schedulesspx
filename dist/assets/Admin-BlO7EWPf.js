import{c as e,d as t,j as s}from"./index-BKLr2_me.js";import{b as a}from"./vendor-B9h2YEfa.js";const l=({weekSchedule:l,setWeekSchedule:n,fetchSchedule:r})=>{const{currentTheme:c}=e(),{user:i,isAuthorized:o,isAdmin:d}=t(),[u,m]=a.useState("Monday"),[h,x]=a.useState({name:"",start:"",end:""}),[p,g]=a.useState(""),[b,y]=a.useState(""),[j,v]=a.useState({title:"",message:"",author:"",isActive:!1});a.useEffect((()=>{0===Object.keys(l).length&&r(),N()}),[]);const N=async()=>{try{const e=localStorage.getItem("accessToken"),t=await fetch("https://schedule-api.devs4u.workers.dev/api/popup",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const e=await t.json();v(e)}}catch(e){}},f=async e=>{try{g("Saving...");const t=localStorage.getItem("accessToken"),s=await fetch("https://schedule-api.devs4u.workers.dev/api/schedule",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!s.ok){const e=await s.text();throw new Error(`HTTP error! status: ${s.status}, message: ${e}`)}await s.json();g("Schedule saved successfully"),setTimeout((()=>g("")),3e3),r()}catch(t){g(`Failed to save schedule: ${t.message}`)}},k=(e,t)=>{const s=document.getElementById("popup-message");if(!s)return;const a=s.selectionStart,l=s.selectionEnd,n=j.message,r=n.substring(a,l);let c;c=r?"[](url)"===e?n.substring(0,a)+`[${r}](url)`+n.substring(l):n.substring(0,a)+e.replace("text",r)+n.substring(l):"[](url)"===e?n.substring(0,a)+`[${t}](url)`+n.substring(l):n.substring(0,a)+e.replace("text",t)+n.substring(l),v((e=>({...e,message:c}))),setTimeout((()=>{s.focus(),r?"[](url)"===e&&(s.selectionStart=a+r.length+2,s.selectionEnd=a+r.length+5):(s.selectionStart=a+e.indexOf("text"),s.selectionEnd=a+e.indexOf("text")+t.length)}),0)},$=`w-full p-2 mb-2 border rounded ${c.input} text-gray-900`;return i&&o()&&d()?s.jsx("div",{className:`flex flex-col h-screen ${c.main} ${c.text}`,children:s.jsx("div",{className:"flex-grow overflow-y-auto",children:s.jsx("div",{className:"container mx-auto p-6",children:s.jsxs("div",{className:`${c.secondary} border-2 ${c.border} p-6 rounded-lg shadow-lg`,children:[s.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Admin Console"}),s.jsxs("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Manage Popup"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"text-lg font-medium mb-2",children:"Current Popup"}),s.jsxs("p",{children:["Title: ",j.title]}),s.jsxs("p",{children:["Message: ",j.message]}),s.jsxs("p",{children:["Author: ",j.author]}),s.jsxs("p",{children:["Active: ",j.isActive?"Yes":"No"]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"text-lg font-medium mb-2",children:"Set New Popup"}),s.jsx("input",{type:"text",placeholder:"Popup Title",value:j.title,onChange:e=>v((t=>({...t,title:e.target.value}))),className:$}),s.jsxs("div",{className:"flex flex-wrap gap-2 mb-2 mt-2",children:[s.jsx("button",{type:"button",onClick:()=>k("**text**","bold text"),className:"px-2 py-1 rounded bg-gray-200 text-gray-800 hover:bg-gray-300 font-medium",title:"Bold",children:"B"}),s.jsx("button",{type:"button",onClick:()=>k("*text*","italic text"),className:"px-2 py-1 rounded bg-gray-200 text-gray-800 hover:bg-gray-300 italic",title:"Italic",children:"I"}),s.jsx("button",{type:"button",onClick:()=>k("# text","Heading"),className:"px-2 py-1 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",title:"Heading 1",children:"H1"}),s.jsx("button",{type:"button",onClick:()=>k("## text","Subheading"),className:"px-2 py-1 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",title:"Heading 2",children:"H2"}),s.jsx("button",{type:"button",onClick:()=>k("[](url)","link text"),className:"px-2 py-1 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",title:"Link",children:"ðŸ”—"}),s.jsx("button",{type:"button",onClick:()=>k("- text","list item"),className:"px-2 py-1 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",title:"Bullet List",children:"â€¢"}),s.jsx("button",{type:"button",onClick:()=>k("1. text","list item"),className:"px-2 py-1 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",title:"Numbered List",children:"1."}),s.jsx("button",{type:"button",onClick:()=>k("`text`","code"),className:"px-2 py-1 rounded bg-gray-200 text-gray-800 hover:bg-gray-300 font-mono",title:"Inline Code",children:"</>"}),s.jsx("button",{type:"button",onClick:()=>k("> text","blockquote"),className:"px-2 py-1 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",title:"Quote",children:'"'})]}),s.jsx("textarea",{id:"popup-message",placeholder:"Popup Message",value:j.message,onChange:e=>v((t=>({...t,message:e.target.value}))),className:$,rows:"5"}),s.jsx("input",{type:"text",placeholder:"Author",value:j.author,onChange:e=>v((t=>({...t,author:e.target.value}))),className:$}),s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx("input",{type:"checkbox",checked:j.isActive,onChange:e=>v((t=>({...t,isActive:e.target.checked}))),className:"mr-2"}),s.jsx("label",{children:"Active"})]}),s.jsx("button",{onClick:async()=>{try{g("Saving popup...");const e=localStorage.getItem("accessToken"),t=await fetch("https://schedule-api.devs4u.workers.dev/api/popup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(j)});if(!t.ok){const e=await t.text();throw new Error(`HTTP error! status: ${t.status}, message: ${e}`)}g("Popup saved successfully"),setTimeout((()=>g("")),3e3),N()}catch(e){g(`Failed to save popup: ${e.message}`)}},className:`${c.accent} px-4 py-2 rounded hover:opacity-80`,children:"Save Popup"})]})]}),s.jsxs("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Manage Schedule"}),s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("div",{className:"flex space-x-4",children:[s.jsx("button",{onClick:()=>{if(h.name&&h.start&&h.end){const e=`${h.name} - ${h.start}-${h.end}`,t={...l,[u]:[...l[u],e]};n(t),x({name:"",start:"",end:""}),f(t)}},className:`${c.accent} px-4 py-2 rounded hover:opacity-80`,children:"Add Period"}),s.jsx("button",{onClick:()=>{const e=b.trim().split("\n").slice(1).map((e=>{const[t,s,a]=e.split("\t");return`${t} - ${s}-${a}`})),t={...l,[u]:e};n(t),f(t),y("")},className:`${c.accent} px-4 py-2 rounded hover:opacity-80`,children:"Add Bulk Periods"})]})}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block mb-2",children:"Select Day:"}),s.jsx("select",{value:u,onChange:e=>m(e.target.value),className:$,children:Object.keys(l).map((e=>s.jsx("option",{value:e,children:e},e)))})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("h4",{className:"text-lg font-medium mb-2",children:[u,"'s Schedule"]}),s.jsx("ul",{className:"space-y-2",children:l[u]&&l[u].map(((e,t)=>s.jsxs("li",{className:"flex justify-between items-center",children:[s.jsx("span",{children:e}),s.jsx("button",{onClick:()=>(e=>{const t={...l,[u]:l[u].filter(((t,s)=>s!==e))};n(t),f(t)})(t),className:`${c.accent} px-2 py-1 rounded hover:opacity-80`,children:"Remove"})]},t)))})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"text-lg font-medium mb-2",children:"Add New Period"}),s.jsx("input",{type:"text",placeholder:"Period Name",value:h.name,onChange:e=>x((t=>({...t,name:e.target.value}))),className:$}),s.jsx("input",{type:"time",value:h.start,onChange:e=>x((t=>({...t,start:e.target.value}))),className:$}),s.jsx("input",{type:"time",value:h.end,onChange:e=>x((t=>({...t,end:e.target.value}))),className:$})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"text-lg font-medium mb-2",children:"Bulk Add Periods"}),s.jsx("textarea",{value:b,onChange:e=>y(e.target.value),placeholder:"Paste formatted schedule here...",className:$,rows:"10"})]})]}),p&&s.jsx("p",{className:"mt-2 "+(p.includes("Failed")?"text-red-500":"text-green-500"),children:p})]})})})}):s.jsx("div",{className:`${c.main} rounded-lg shadow-lg w-full border-2 ${c.border} relative h-full flex flex-col justify-center items-center`,children:s.jsx("p",{className:`${c.text} text-center`,children:"You are not authorized to access the admin panel."})})};export{l as default};
