import{c as e,d as t,j as s}from"./index-BKLr2_me.js";import{b as l}from"./vendor-B9h2YEfa.js";const o=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],r=({weekSchedule:r,lastSchoolDay:a,customEndTime:n,largeSizing:i=!1})=>{const{currentTheme:c}=e(),{user:d,isLoggedIn:u,isAuthorized:m}=t(),[h,x]=l.useState(null),[p,f]=l.useState(0),[y,$]=l.useState(""),[b,g]=l.useState({});l.useEffect((()=>{const e=localStorage.getItem("customPeriodNames");e&&g(JSON.parse(e))}),[]);const N=l.useCallback((e=>{if(!e)return null;const[t,s]=e.split(" ");let[l,o]=t.split(":").map(Number);"pm"===s?.toLowerCase()&&12!==l?l+=12:"am"===s?.toLowerCase()&&12===l&&(l=0);const r=new Date;return new Date(r.getFullYear(),r.getMonth(),r.getDate(),l,o)}),[]),S=l.useCallback((e=>{const t=Math.floor(e/1e3),s=Math.floor(t/60),l=Math.floor(s/60),o=Math.floor(l/24);return o>0?`${o}d ${l%24}h ${s%60}m`:l>0?`${l}h ${s%60}m ${t%60}s`:s>0?`${s}m ${t%60}s`:`${t}s`}),[]),w=l.useCallback(((e,t)=>{document.title=t?`${e} - ${t}`:"Schedule-SPX"}),[]),v=l.useCallback((e=>{let t=o[(o.indexOf(e)+1)%7],s=0;for(;!r[t]&&s<7;)t=o[(o.indexOf(t)+1)%7],s++;return s<7?t:null}),[r]),D=l.useCallback(((e,t)=>(o.indexOf(t)-o.indexOf(e)+7)%7),[]),j=l.useCallback(((e,t,s)=>{const l=(s-e)/(t-e)*100;return Math.min(Math.max(l,0),100)}),[]),C=l.useCallback((()=>{if(!a)return null;const e=new Date(a);return e.setHours(15,0,0,0),e}),[a]),k=l.useCallback(((e,t,s)=>{const l=C(),o=N(e[0].split(" - ")[1].split("-")[0].trim()),r=e.find((e=>{const[,s]=e.split(" - "),[l,o]=s.split("-").map((e=>N(e.trim())));return l&&o&&t>=l&&t<o}));if(r){const[e,s]=r.split(" - "),[l,o]=s.split("-").map((e=>N(e.trim()))),a=j(l,o,t),n=o-t,i=/^[1-8]$/.test(e)&&b[`period${e}`]||e;x({type:"activePeriod",name:i}),f(a),$(S(n)),w(i,S(n))}else{const r=e.find((e=>{const s=N(e.split(" - ")[1].split("-")[0].trim());return s&&t<s}));if(r){const[s,l]=r.split(" - "),a=N(l.split("-")[0].trim()),n=e.indexOf(r)-1,i=n>=0?N(e[n].split(" - ")[1].split("-")[1].trim()):o,c=j(i,a,t),d=a-t;x({type:"betweenPeriods",nextPeriod:s}),$(S(d)),f(c),w(`Next: ${s}`,S(d))}else if(e[0]&&t<N(e[0].split(" - ")[1].split("-")[0].trim())){const s=N(e[0].split(" - ")[1].split("-")[0].trim()),o=j(l,s,t),r=s-t;x({type:"beforeSchool",nextPeriod:e[0].split(" - ")[0]}),$(S(r)),f(o),w("School starts in",S(r))}else P(t,s)}}),[N,S,w,j,C,b]),M=l.useCallback(((e,t)=>{const s=v(t);if(s&&r[s]?.[0]){const l=r[s],o=N(l[0].split(" - ")[1].split("-")[0].trim()),a=new Date(e);a.setDate(a.getDate()+D(t,s)),a.setHours(o.getHours(),o.getMinutes(),0,0);const n=C(),i=a-e,c=j(n,a,e);x({type:"nonSchoolDay",nextDay:s}),$(S(i)),f(c),w("Next school day",S(i))}else x({type:"noSchool"}),$(""),f(100),w("No School","")}),[r,v,D,N,S,w,j,C]),P=l.useCallback(((e,t)=>{const s=v(t);if(s&&r[s]?.[0]){const l=r[s],o=N(l[0].split(" - ")[1].split("-")[0].trim()),a=new Date(e);a.setDate(a.getDate()+D(t,s)),a.setHours(o.getHours(),o.getMinutes(),0,0);const n=C(),i=a-e,c=j(n,a,e);x({type:"afterSchool",nextDay:s}),$(S(i)),f(c),w("Next school day",S(i))}else M(e,t)}),[r,v,N,S,w,M,j,D,C]);l.useEffect((()=>{const e=()=>{const e=new Date;if(n){const[t,s]=n.split(":").map(Number),l=new Date;l.setHours(t,s,0,0),l<e&&l.setDate(l.getDate()+1);const o=l-e,r=100*(1-o/36e5);return x({type:"customEndTime",name:"Custom Timer"}),f(Math.min(Math.max(r,0),100)),$(S(o)),void w("Custom Timer",S(o))}const t=e.toLocaleDateString("en-US",{weekday:"long"}),s=r[t];Array.isArray(s)&&s.length>0?k(s,e,t):M(e,t)},t=setInterval(e,1e3);return e(),()=>clearInterval(t)}),[r,k,M,n,S,w]);const T=l.useMemo((()=>{if(!h)return null;const e=i?"text-4xl mb-6":"text-xl mb-4",t=i?"h-14 mb-8":"h-6 mb-4",l=i?"text-6xl font-bold":"text-lg font-medium";return s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("p",{className:`${e} font-bold ${c.text} text-center`,children:(()=>{if("customEndTime"===h.type)return"Time Remaining:";switch(h.type){case"activePeriod":return`${h.name}`;case"betweenPeriods":return`Next Period: ${h.nextPeriod}`;case"beforeSchool":return`School starts in: ${y}`;case"afterSchool":return`School ended. Next school day: ${h.nextDay}`;case"nonSchoolDay":return`No school today. Next school day: ${h.nextDay}`;case"noSchool":return"No school today";default:return""}})()}),s.jsxs("div",{className:`w-full bg-opacity-20 ${c.main} rounded-full ${t} relative overflow-hidden`,children:[s.jsx("div",{className:`${c.accent} h-full rounded-full transition-all duration-1000 ease-in-out absolute top-0 left-0`,style:{width:`${p}%`}}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("p",{className:`${i?"text-2xl":"text-sm"} font-semibold ${c.text} z-10`,children:[p.toFixed(1),"%"]})})]}),s.jsx("p",{className:`${l} ${c.text}`,children:y})]})}),[h,c,p,y,i]);return u()?m()?s.jsxs("div",{className:`${c.main} rounded-lg shadow-lg w-full border-2 ${c.border} relative ${i?"p-10":"p-5"}`,children:[s.jsx("div",{className:"absolute inset-0 rounded-lg",style:{background:"linear-gradient(to top right, rgba(0, 0, 0, 0.5), transparent)",zIndex:0}}),s.jsx("div",{className:"relative z-10 "+(i?"pt-4":""),children:T})]}):s.jsx("div",{className:`${c.main} rounded-lg shadow-lg w-full border-2 ${c.border} relative h-full flex flex-col justify-center items-center`,children:s.jsx("p",{className:`${c.text} text-center`,children:"You are not authorized to view the period progress."})}):s.jsx("div",{className:`${c.main} rounded-lg shadow-lg w-full border-2 ${c.border} relative h-full flex flex-col justify-center items-center`,children:s.jsx("p",{className:`${c.text} text-center`,children:"Please log in to view the period progress."})})};export{r as P};
